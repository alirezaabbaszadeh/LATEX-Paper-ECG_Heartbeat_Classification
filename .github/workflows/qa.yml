name: QA

on:
  pull_request:
    branches: [release]
    types: [opened, synchronize, reopened, ready_for_review]
  push:
    tags:
      - '*'
  workflow_dispatch:

permissions:
  contents: read
  pull-requests: read

jobs:
  latex-lint:
    name: LaTeX lint (chktex)
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Install chktex
        run: |
          sudo apt-get update
          sudo apt-get install -y chktex

      - name: Run chktex across paper sources
        run: |
          set -euo pipefail
          mapfile -t tex_files < <(find paper -name '*.tex' -type f | sort)
          if [ ${#tex_files[@]} -eq 0 ]; then
            echo "No LaTeX sources found to lint."
            exit 0
          fi
          chktex -q -n1 "${tex_files[@]}"

  figure-formats:
    name: Figure format validation
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Validate figure formats
        run: |
          python3 paper/scripts/check_figure_formats.py

  references:
    name: Reference validation
    uses: ./.github/workflows/bibtex-lint.yml
