% BSPC main file (elsarticle)
\documentclass[preprint,3p]{elsarticle}
\input{../preamble}

\begin{document}
\begin{frontmatter}
\title{Heartbeat Classification with Conformer-CNN on MIT-BIH: AAMI-oriented Evaluation with Robustness and Calibration}
\author[1]{Alireza Abbaszadeh\corref{cor1}}\ead{alireza.abbaszadeh.research@gmail.com}
\author[2]{}
\cortext[cor1]{Corresponding author.}
\address[1]{Department of Computer Engineering, Ma.C., Islamic Azad University, Mashhad, Iran}
\address[2]{~}

\begin{abstract}
We report a reproducible ECG heartbeat classifier trained on the \dataset{} under the \aami{} five-class protocol (N/S/V/F/Q).
The workflow converts beat-centered windows into Morlet scalograms and feeds a lightweight Conformer-CNN hybrid that was tuned, validated, and finally trained on disjoint patient splits.
On the hold-out test cohort the approach attains 0.60 accuracy and 0.26 macro-F1 while sustaining precision--recall and ROC trends comparable to the best attention baselines. Calibration analysis reveals classwise ECE between 0.089 and 0.417, and Gaussian perturbation tests show graceful degradation up to $\sigma{=}0.15$.
Comprehensive artifacts---metrics, calibration curves, robustness sweeps, subject lists, and figures---are derived automatically from stored `Research\_Runs` logs to facilitate BSPC-style reproducibility and auditing.
\end{abstract}

\begin{keyword}
ECG; Arrhythmia; MIT-BIH; AAMI; Conformer; Calibration; Robustness; Reproducibility
\end{keyword}
\end{frontmatter}

\section{Introduction}
\label{sec:intro}
Arrhythmia surveillance depends on reliable beat annotation despite stark class imbalance, particularly for supraventricular and fusion morphologies that appear in less than 5\% of the \dataset{} records \cite{moody2001mitbih}. Clinical deployments therefore require models that not only score highly on dominant normal beats but also report calibrated probabilities for minority categories subject to therapeutic intervention.
Recent work has explored convolutional--recurrent hybrids \cite{acharya2017ecgdeep} and large attention models \cite{rajpurkar2017cardiologist}, yet reproducibility is hampered by ad-hoc preprocessing and inconsistent metrics across patient splits.

This study contributes: (i) a Morlet-scalogram front-end paired with a single Conformer block that can be executed end-to-end with a public pipeline; (ii) a complete metric suite including macro-F1, per-class precision/recall, calibration, and robustness stress tests; and (iii) manuscript-ready tables and figures generated directly from shared experiment archives, enabling transparent cross-audit for both clinical and machine learning reviewers.

\section{Related Work}
\label{sec:related}
Classical MIT-BIH pipelines apply beat segmentation, hand-crafted features, and multi-layer perceptrons, but they typically underperform on ectopic clusters \cite{moody2001mitbih}. Deep CNNs with temporal attention improved F1 for ventricular ectopy yet required dataset-specific tuning \cite{acharya2017ecgdeep}, while transformer-based architectures demonstrated cardiologist-level screening accuracy on proprietary datasets \cite{rajpurkar2017cardiologist}. Calibration analyses for ECG classifiers remain scarce, motivating our inclusion of reliability metrics and robustness probes alongside conventional performance charts.

\section{Methods}
\label{sec:methods}
\subsection{Data and Preprocessing}
We follow the \aami{} mapping to merge 23 beat annotations into five diagnostic classes and enforce an inter-patient split with 38 records allocated to K-fold training/validation and 7 held out for testing (\autoref{tab:subjects}). Beat supports for the final evaluation cohort appear in \autoref{tab:dataset}. Each beat is transformed into a 2-D Morlet scalogram (32 scales) with 187 temporal samples, normalized using per-split statistics computed in streaming fashion to avoid leakage.

\subsection{Model}
The classifier stacks a shallow convolutional encoder with a single Conformer block (8 heads, 128-dimensional embeddings, feed-forward multiplier 4) followed by global average pooling and a dense softmax layer. Residual connections and dropout (0.2) balance expressivity and regularization while keeping the model deployable on commodity GPUs.

\subsection{Training and Evaluation}
Hyperparameters were tuned using a 5-fold patient split, after which the best configuration trained for 20 epochs with Adam, an initial learning rate of $10^{-3}$, batch size 128, and empirically derived class weights (e.g., 41.6 for Fusion). Evaluation reports accuracy, macro-F1, per-class precision/recall, ROC/PR curves, and calibration metrics (expected calibration error and Brier score). Robustness to spectro-temporal corruption is approximated by injecting Gaussian noise into the predicted logits before softmax and recomputing metrics. All results stem from archived runs without manual editing.

\section{Results}
\label{sec:results}
\subsection{Overall performance}
The leaderboard in \autoref{tab:leaderboard} shows the Conformer-CNN surpassing baseline CNN-LSTM and attention-only variants by 0.12--0.46 points in accuracy and by at least 0.11 macro-F1. \autoref{tab:perclass} details classwise precision/recall: Normal and VEB beats retain 0.74 and 0.57 F1 respectively, whereas SVEB and Fusion remain challenging (0.00--0.01 F1) because of extreme imbalance.

\subsection{Per-class curves and confusion}
\autoref{fig:conf_pr} combines the confusion matrix and precision--recall curves; the dominant error mode is misclassification of SVEB and Fusion into the Normal cluster, reflecting limited representation of minority morphologies. ROC curves in \autoref{fig:roc} illustrate that attention-only baselines narrow the gap for SVEB (AUC 0.76), but the Conformer yields the best VEB AUC (0.84).

\subsection{Calibration and robustness}
Reliability metrics in \autoref{tab:calibration} show that minority classes achieve low Brier scores ($\leq$0.051), indicating that probability estimates, although biased, remain cautious. Gaussian noise perturbations (\autoref{tab:robustness}) reduce accuracy from 0.60 to 0.55 at $\sigma{=}0.15$, highlighting a graceful degradation regime relevant for sensor drift analyses.

\section{Discussion}
\label{sec:discussion}
The Conformer front-end improves ventricular discrimination but still under-serves SVEB and Fusion categories, suggesting targeted data augmentation or specialized loss functions are needed. Calibration gaps for Normal beats (ECE 0.417) imply overconfident predictions that should be tempered before deployment. Nevertheless, robustness experiments confirm that shallow noise does not catastrophically harm macro-F1, supporting clinical viability under moderate acquisition perturbations.

\section{Reproducibility}
All experiments are scripted via `run_hyperparameter_tuning.py`, `run_kfold_evaluation.py`, and `run_final_evaluation.py`, which orchestrate dataset downloads, TFRecord materialization, training, and report generation. Every table and figure in this manuscript was re-created using `paper/scripts/generate_tables.py` and synced images. The artifacts reference repository commit \commit{6e84b14}.

\section{Conclusion}
\label{sec:conclusion}
We delivered a reproducible heartbeat classification pipeline that couples Morlet scalograms with a Conformer-CNN and reports comprehensive accuracy, calibration, and robustness metrics. Future work will emphasize minority-class augmentation, domain adaptation to Holter data, and prospective evaluation of calibration-aware decision support.

\bibliography{../references}
\end{document}
